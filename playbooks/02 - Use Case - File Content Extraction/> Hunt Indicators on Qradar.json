{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "> Hunt Indicators on Qradar",
    "aliasName": null,
    "tag": null,
    "description": "Hunt indicator value on FortiSIEM for the past X Minutes",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "indicator_data"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/da94c291-2600-4bad-bf39-22c3f144b916",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/92cfd7c4-ca6d-46de-96b7-82f1d7995878",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Update Indicator",
            "description": null,
            "arguments": {
                "version": "3.2.3",
                "resource": {
                    "description": "{{(vars.indicator_data[\"@id\"] | fromIRI).description}}\n{{vars.steps.Create_Description.data['formatted_string']}}"
                },
                "operation": "Append",
                "collection": "{{vars.indicator_data[\"@id\"]}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/indicators",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "1110",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "d670ed75-f31b-49db-96b1-31050ace2fdb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Build Query",
            "description": null,
            "arguments": {
                "qradar_query": "select qid,starttime,sourceip, LOGSOURCENAME(logsourceid),UTF8(payload) FROM events WHERE UTF8(payload) ILIKE '%{{vars.indicator_data.value}}%' LAST {{vars.last_x_minutes}} MINUTES"
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "307687c6-41c2-443d-8b26-3fbe1d8ebc8d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Exit",
            "description": null,
            "arguments": {
                "params": [],
                "version": "3.2.0",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "d67903d8-27d9-47c6-ac22-7b4869b213bb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Compute Results",
            "description": null,
            "arguments": {
                "hunt_results": "{% if vars.query_results | length > vars.max_events %}{{vars.query_results[:vars.max_events]}}{% else %}{{vars.query_results}}{% endif %}"
            },
            "status": null,
            "top": "705",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "978bd138-cf61-4864-8278-457dd292c370"
        },
        {
            "@type": "WorkflowStep",
            "name": "Run Aerial Query",
            "description": null,
            "arguments": {
                "name": "IBM QRadar",
                "config": "bf7bd57c-2218-4efb-8bec-bce11fe62015",
                "params": {
                    "search_string": "{{vars.qradar_query}}"
                },
                "version": "1.5.1",
                "connector": "qradar",
                "operation": "query_qradar",
                "mock_result": "{\n  \"data\": {\n    \"events\": []\n  },\n  \"status\": \"Success\",\n  \"message\": \"\",\n  \"operation\": null\n}",
                "operationTitle": "Make an Ariel Query to QRadar",
                "pickFromTenant": false,
                "step_variables": {
                    "query_results": "{{vars.result.data.events}}"
                }
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "45f67a2f-0198-455e-8445-47f33457e237"
        },
        {
            "@type": "WorkflowStep",
            "name": "Build Description",
            "description": null,
            "arguments": {
                "events_html": "{{vars.hunt_results | json2html(row_fields=[\"qid\",\"sourceip\"], template=\"Stylized with row selection\", display=\"Vertical\", styling=false, table_style={})}}"
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4faefdec-cb97-483e-9332-60b825963b94"
        },
        {
            "@type": "WorkflowStep",
            "name": "Indicator Found",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/978bd138-cf61-4864-8278-457dd292c370",
                        "condition": "{{ vars.query_results | length > 0 }}",
                        "step_name": "Compute Results"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/d67903d8-27d9-47c6-ac22-7b4869b213bb",
                        "step_name": "Exit"
                    }
                ]
            },
            "status": null,
            "top": "570",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "71acd014-4c08-48a6-929c-e3db218f59ec"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Events",
            "description": null,
            "arguments": {
                "when": "{{vars.hunt_results | length > 0}}",
                "for_each": {
                    "item": "{{vars.hunt_results}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "source": "{{vars.item.logsourcename_logsourceid}}",
                    "sourceId": "{{vars.item.qid|string}}",
                    "__replace": "",
                    "indicators": "{{vars.indicator_data[\"@id\"]}}",
                    "description": "{{vars.item.utf8_payload}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/events",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "1245",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "e6b8d144-2fe5-483f-adce-a04c054c2971"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Description",
            "description": null,
            "arguments": {
                "params": {
                    "value": "<p><strong>Indicator Matched Events from Qradar:<\/strong> <span style=\"font-size: 12pt; color: #e67e23;\">{{vars.hunt_results|length}}<\/span><\/p>\n<hr \/>\n<p><span style=\"font-size: 12pt;\">{{vars.events_html}}<\/span><\/p>"
                },
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "format_richtext_html",
                "operationTitle": "Utils: Format as RichText (HTML)",
                "step_variables": []
            },
            "status": null,
            "top": "975",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "29696da9-3586-47c2-b662-ba10c9c41ab7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "max_events": "10",
                "useMockOutput": "{{globalVars.Demo_mode}}",
                "indicator_data": "{{vars.input.params['indicator_data']}}",
                "last_x_minutes": "60"
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2f6caabf-9092-4e40-99f4-65f29ab215ff"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "92cfd7c4-ca6d-46de-96b7-82f1d7995878"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Indicator Found -> Exit",
            "targetStep": "\/api\/3\/workflow_steps\/d67903d8-27d9-47c6-ac22-7b4869b213bb",
            "sourceStep": "\/api\/3\/workflow_steps\/71acd014-4c08-48a6-929c-e3db218f59ec",
            "label": "No",
            "isExecuted": false,
            "uuid": "1129cae6-8168-4bdf-b24e-4e6030cc28a7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Build Query",
            "targetStep": "\/api\/3\/workflow_steps\/307687c6-41c2-443d-8b26-3fbe1d8ebc8d",
            "sourceStep": "\/api\/3\/workflow_steps\/2f6caabf-9092-4e40-99f4-65f29ab215ff",
            "label": null,
            "isExecuted": false,
            "uuid": "8e582780-4126-4407-a020-ecf7006acaf0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Build Query -> Run Aerial Query",
            "targetStep": "\/api\/3\/workflow_steps\/45f67a2f-0198-455e-8445-47f33457e237",
            "sourceStep": "\/api\/3\/workflow_steps\/307687c6-41c2-443d-8b26-3fbe1d8ebc8d",
            "label": null,
            "isExecuted": false,
            "uuid": "eb9edf72-1a7a-4f8f-a0b3-152dd877a44e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Run Aerial Query -> Indicator Found",
            "targetStep": "\/api\/3\/workflow_steps\/71acd014-4c08-48a6-929c-e3db218f59ec",
            "sourceStep": "\/api\/3\/workflow_steps\/45f67a2f-0198-455e-8445-47f33457e237",
            "label": null,
            "isExecuted": false,
            "uuid": "5ed179cc-b7a0-4ade-bc2f-71ac10ad7efa"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Indicator Found -> Compute Hunt Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/978bd138-cf61-4864-8278-457dd292c370",
            "sourceStep": "\/api\/3\/workflow_steps\/71acd014-4c08-48a6-929c-e3db218f59ec",
            "label": "Yes",
            "isExecuted": false,
            "uuid": "f0257fae-f9e3-4ca9-a572-ef158c3dad7a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Compute Results -> Build Description",
            "targetStep": "\/api\/3\/workflow_steps\/4faefdec-cb97-483e-9332-60b825963b94",
            "sourceStep": "\/api\/3\/workflow_steps\/978bd138-cf61-4864-8278-457dd292c370",
            "label": null,
            "isExecuted": false,
            "uuid": "af1f4bb7-098a-4ac8-aa4c-884afdbe04fd"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Build Description -> Create Description",
            "targetStep": "\/api\/3\/workflow_steps\/29696da9-3586-47c2-b662-ba10c9c41ab7",
            "sourceStep": "\/api\/3\/workflow_steps\/4faefdec-cb97-483e-9332-60b825963b94",
            "label": null,
            "isExecuted": false,
            "uuid": "5efa4998-9deb-46aa-b368-5e28fc91fe7c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Description -> Update Indicator",
            "targetStep": "\/api\/3\/workflow_steps\/d670ed75-f31b-49db-96b1-31050ace2fdb",
            "sourceStep": "\/api\/3\/workflow_steps\/29696da9-3586-47c2-b662-ba10c9c41ab7",
            "label": null,
            "isExecuted": false,
            "uuid": "bd93b28b-1789-477c-adad-b70171cd48c4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update Indicator -> Create Events",
            "targetStep": "\/api\/3\/workflow_steps\/e6b8d144-2fe5-483f-adce-a04c054c2971",
            "sourceStep": "\/api\/3\/workflow_steps\/d670ed75-f31b-49db-96b1-31050ace2fdb",
            "label": null,
            "isExecuted": false,
            "uuid": "765424fe-978c-4a71-919c-c1e662934726"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/2f6caabf-9092-4e40-99f4-65f29ab215ff",
            "sourceStep": "\/api\/3\/workflow_steps\/92cfd7c4-ca6d-46de-96b7-82f1d7995878",
            "label": null,
            "isExecuted": false,
            "uuid": "4b28d9e6-42e7-4061-be17-913853a57ff0"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "a6405ff1-ec70-4244-bea3-184ab4f45a54",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Use-Case",
        "Threat-Hunting",
        "File-Content-Extraction"
    ]
}