{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Extract and Hunt Indicators on SIEM",
    "aliasName": null,
    "tag": null,
    "description": "Extracts indicators from a file and checks for any match on SIEM Events",
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/da94c291-2600-4bad-bf39-22c3f144b916",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/c72f1610-8175-4222-be57-2fcd0f2454e7",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Process Indicators",
            "description": null,
            "arguments": {
                "public_ips": "{{vars.indicators.IP| ipaddr('public') or []}}",
                "private_ips": "{{vars.indicators.IP| ipaddr('private') or []}}",
                "md5_hashcodes": "{{vars.indicators.MD5}}",
                "shax_hashcodes": "{{vars.indicators.SHA1 + vars.indicators.SHA256}}"
            },
            "status": null,
            "top": "570",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "50d0cc42-9801-461c-8500-9f3d9537caea"
        },
        {
            "@type": "WorkflowStep",
            "name": "Lookup Hash code Details",
            "description": null,
            "arguments": {
                "when": "{{vars.shax_hashcodes | length > 0}}",
                "for_each": {
                    "item": "{{vars.shax_hashcodes}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "indicator": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/6e596b7f-704c-45b7-a6f3-845be3f0c09d"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "5072b5ff-5cf8-413b-b95e-7298f3e5fe5a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Build Indicators List to Hunt",
            "description": null,
            "arguments": {
                "indicators_to_hunt": "{{vars.md5_hashcodes+ vars.indicators.Host + vars.indicators.URL + vars.indicators.Filename + vars.public_ips}}"
            },
            "status": null,
            "top": "705",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "5ba4d4ec-a042-42e6-95be-9700291a58f3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "9f7d13fa-5999-48b1-be43-44d4cf039f8d",
                "resources": [
                    "attachments"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "attachments": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "c72f1610-8175-4222-be57-2fcd0f2454e7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Whitelist and Unify Indicators",
            "description": null,
            "arguments": {
                "_tmp": "{% for entry in vars.indicators.unified_result %}\n{% if entry.value in vars.indicators_to_hunt and entry.value not in vars.whitelisted_indicators %}\n{{vars.unified_indicators.append(entry)}}{% endif %}{% endfor %}"
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "6aed4dec-9513-4baa-a3d6-567745fed8fe"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "unified_indicators": "[]",
                "whitelisted_indicators": "{{globalVars.Excludelist_IPs.split(',')|union(globalVars.Excludelist_URLs.split(','))|union(globalVars.Excludelist_Domains.split(','))}}"
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "e7dad3fd-2978-4817-88cb-662e1ba2ec37"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Raw Data",
            "description": null,
            "arguments": {
                "name": "File Content Extraction",
                "params": {
                    "file_iri": "{{vars.input.records[0].file['@id']}}",
                    "html_output_format": false
                },
                "version": "1.0.3",
                "connector": "file-content-extraction",
                "operation": "extract_text",
                "operationTitle": "Extract Text",
                "pickFromTenant": false,
                "step_variables": {
                    "raw_data": "{{vars.result.data['extracted_text'].replace('[','').replace(']','')}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "1137c990-4151-4207-86dd-6a548f525314"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Indicators",
            "description": null,
            "arguments": {
                "indicators": "{{vars.raw_data | extract_artifacts}}"
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "a4862812-555d-42ad-a735-992cf41219fb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Indicators",
            "description": null,
            "arguments": {
                "when": "{{vars.unified_indicators | length > 0}}",
                "for_each": {
                    "item": "{{vars.unified_indicators}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "tlp": "\/api\/3\/picklists\/7bff95b7-6438-4b01-b23a-0fe8cb5b33d3",
                    "value": "{{vars.item.value}}",
                    "__replace": "true",
                    "recordTags": [
                        "\/api\/3\/tags\/CERT"
                    ],
                    "indicatorStatus": "\/api\/3\/picklists\/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "typeofindicator": "{{\"IndicatorType\" | picklist(vars.item.type, \"@id\")}}",
                    "enrichmentStatus": "\/api\/3\/picklists\/a6d9da29-27b1-4b8a-965d-8d91518540d5"
                },
                "_showJson": true,
                "operation": "Append",
                "collection": "\/api\/3\/upsert\/indicators",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "975",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "7a6e62ea-aa23-41c4-b9a5-95b36fe64e4f"
        },
        {
            "@type": "WorkflowStep",
            "name": "Hunt Indicators on Qradar",
            "description": null,
            "arguments": {
                "when": "{{vars.steps.Create_Indicators | length > 0}}",
                "for_each": {
                    "item": "{{vars.steps.Create_Indicators}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "indicator_data": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/a6405ff1-ec70-4244-bea3-184ab4f45a54"
            },
            "status": null,
            "top": "1110",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "1208a4f5-d616-4fd1-9c9f-06eaf5849841"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Extract Indicators -> Copy of Build Indicators List to Hunt",
            "targetStep": "\/api\/3\/workflow_steps\/50d0cc42-9801-461c-8500-9f3d9537caea",
            "sourceStep": "\/api\/3\/workflow_steps\/a4862812-555d-42ad-a735-992cf41219fb",
            "label": null,
            "isExecuted": false,
            "uuid": "def036c4-a775-4156-99c0-3cbf18c7ac65"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Process Indicators -> Build Indicators List to Hunt",
            "targetStep": "\/api\/3\/workflow_steps\/5ba4d4ec-a042-42e6-95be-9700291a58f3",
            "sourceStep": "\/api\/3\/workflow_steps\/50d0cc42-9801-461c-8500-9f3d9537caea",
            "label": null,
            "isExecuted": false,
            "uuid": "12bcffd3-6502-4784-913b-60fe3911fbe7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Build Indicators List to Hunt -> Copy 1 of Build Indicators List to Hunt",
            "targetStep": "\/api\/3\/workflow_steps\/6aed4dec-9513-4baa-a3d6-567745fed8fe",
            "sourceStep": "\/api\/3\/workflow_steps\/5ba4d4ec-a042-42e6-95be-9700291a58f3",
            "label": null,
            "isExecuted": false,
            "uuid": "5b185e34-b627-4c08-847d-71be371f1800"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Unified Indicators List -> Create Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/7a6e62ea-aa23-41c4-b9a5-95b36fe64e4f",
            "sourceStep": "\/api\/3\/workflow_steps\/6aed4dec-9513-4baa-a3d6-567745fed8fe",
            "label": null,
            "isExecuted": false,
            "uuid": "6c4c7387-832a-40c6-9306-7528570bfb42"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Process Indicators -> Lookup Hash code Details",
            "targetStep": "\/api\/3\/workflow_steps\/5072b5ff-5cf8-413b-b95e-7298f3e5fe5a",
            "sourceStep": "\/api\/3\/workflow_steps\/50d0cc42-9801-461c-8500-9f3d9537caea",
            "label": null,
            "isExecuted": false,
            "uuid": "163efd61-c0a0-4343-9f1f-bbb26bfc16c4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Indicators -> Hunt Indicators on Qradar",
            "targetStep": "\/api\/3\/workflow_steps\/1208a4f5-d616-4fd1-9c9f-06eaf5849841",
            "sourceStep": "\/api\/3\/workflow_steps\/7a6e62ea-aa23-41c4-b9a5-95b36fe64e4f",
            "label": null,
            "isExecuted": false,
            "uuid": "4ba7e0d0-aedb-4cc3-965a-d0588fda97d3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/e7dad3fd-2978-4817-88cb-662e1ba2ec37",
            "sourceStep": "\/api\/3\/workflow_steps\/c72f1610-8175-4222-be57-2fcd0f2454e7",
            "label": null,
            "isExecuted": false,
            "uuid": "5b238026-e725-4d06-875c-b06364d59cd7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Extract Raw Data",
            "targetStep": "\/api\/3\/workflow_steps\/1137c990-4151-4207-86dd-6a548f525314",
            "sourceStep": "\/api\/3\/workflow_steps\/e7dad3fd-2978-4817-88cb-662e1ba2ec37",
            "label": null,
            "isExecuted": false,
            "uuid": "bf6d9a6b-673b-450f-ac17-ecd2c40e18bf"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract Raw Data -> Extract Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/a4862812-555d-42ad-a735-992cf41219fb",
            "sourceStep": "\/api\/3\/workflow_steps\/1137c990-4151-4207-86dd-6a548f525314",
            "label": null,
            "isExecuted": false,
            "uuid": "66ce9b5e-fc39-441f-8a3a-7a44fa4da2a6"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "3e434aee-9bbb-4a10-8b02-24f8f56c8a92",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ThreatIntelManagement",
        "Use-Case",
        "File-Content-Extraction"
    ]
}